{% extends "base.html" %}

{% block title %}Budget Setup - Budget Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/budget.css') }}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0"><i class="fas fa-calculator me-1"></i> Budget Setup</h4>
    <div class="input-group" id="monthNav" style="width: 200px;">
        <button class="btn btn-sm btn-modern-secondary" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
        <input type="month" class="form-control form-control-sm text-center" id="monthSelector" onchange="loadBudgetForMonth()">
        <button class="btn btn-sm btn-modern-secondary" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
    </div>
</div>

<div class="row">
    <div class="col-lg-8" id="budgetSections">

<!-- Income Categories -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-arrow-up text-success"></i> Income Sources
            <button class="btn btn-sm btn-light float-end ms-2" onclick="toggleAddCategoryForm('income')">
                <i class="fas fa-plus"></i> Add Income
            </button>
            <button class="btn btn-sm btn-light float-end" onclick="addGroup('income')">
                <i class="fas fa-folder-plus"></i> Add Group
            </button>
        </h5>
    </div>
    <div class="card-body">
        <div class="category-columns category-grid">
            <div></div>
            <div class="text-muted">Budget</div>
            <div class="text-muted">Actual</div>
            <div class="text-muted">Remaining</div>
            <div></div>
        </div>
        <div id="incomeCategories">
            <!-- Income categories will be loaded here -->
        </div>
        <div class="add-category-form collapse" id="addIncomeForm">
            <h6>Add Income Category</h6>
            <form onsubmit="addCategory(event, 'income')">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Category Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Default Monthly Amount</label>
                        <input type="number" class="form-control" name="monthly_budget" step="0.01" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Category</button>
                <button type="button" class="btn btn-secondary" onclick="hideAddCategoryForm('income')">Cancel</button>
            </form>
        </div>
    </div>
</div>

<!-- Deduction Categories -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-minus-circle text-warning"></i> Deductions
            <button class="btn btn-sm btn-light float-end ms-2" onclick="toggleAddCategoryForm('deduction')">
                <i class="fas fa-plus"></i> Add Deduction
            </button>
            <button class="btn btn-sm btn-light float-end" onclick="addGroup('income')">
                <i class="fas fa-folder-plus"></i> Add Group
            </button>
        </h5>
    </div>
    <div class="card-body">
        <div class="category-columns category-grid">
            <div></div>
            <div class="text-muted">Budget</div>
            <div class="text-muted">Actual</div>
            <div class="text-muted">Remaining</div>
            <div></div>
        </div>
        <div id="deductionCategories">
            <!-- Deduction categories will be loaded here -->
        </div>
        <div class="add-category-form collapse" id="addDeductionForm">
            <h6>Add Deduction Category</h6>
            <form onsubmit="addCategory(event, 'deduction')">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Deduction Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Default Monthly Amount</label>
                        <input type="number" class="form-control" name="monthly_budget" step="0.01" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Deduction</button>
                <button type="button" class="btn btn-secondary" onclick="hideAddCategoryForm('deduction')">Cancel</button>
            </form>
        </div>
    </div>
</div>

<!-- Expense Categories -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-arrow-down text-danger"></i> Expense Categories
            <button class="btn btn-sm btn-light float-end ms-2" onclick="toggleAddCategoryForm('expense')">
                <i class="fas fa-plus"></i> Add Expense
            </button>
            <button class="btn btn-sm btn-light float-end" onclick="addGroup('expense')">
                <i class="fas fa-folder-plus"></i> Add Group
            </button>
        </h5>
    </div>
    <div class="card-body">
        <div class="category-columns category-grid">
            <div></div>
            <div class="text-muted">Budget</div>
            <div class="text-muted">Actual</div>
            <div class="text-muted">Remaining</div>
            <div></div>
        </div>
        <div id="expenseCategories">
            <!-- Expense categories will be loaded here -->
        </div>
        <div class="add-category-form collapse" id="addExpenseForm">
            <h6>Add Expense Category</h6>
            <form onsubmit="addCategory(event, 'expense')">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Category Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Default Monthly Budget</label>
                        <input type="number" class="form-control" name="monthly_budget" step="0.01" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Category</button>
                <button type="button" class="btn btn-secondary" onclick="hideAddCategoryForm('expense')">Cancel</button>
            </form>
        </div>
    </div>
</div>

<!-- Fund Expenses -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-piggy-bank text-primary"></i> Fund Contributions
        </h5>
    </div>
    <div class="card-body">
        <div class="category-columns category-grid">
            <div></div>
            <div class="text-muted">Budget</div>
            <div class="text-muted">Actual</div>
            <div class="text-muted">Remaining</div>
            <div></div>
        </div>
        <div id="fundCategories">
            <!-- Fund categories will be loaded here -->
        </div>
    </div>
</div>
    </div> <!-- end col-lg-8 -->
    <div class="col-lg-4" id="summaryColumn">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Money To Budget</h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="summaryTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="sum-tab" data-bs-toggle="tab" data-bs-target="#sum" type="button" role="tab">Summary</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="inc-tab" data-bs-toggle="tab" data-bs-target="#income-summary" type="button" role="tab">Income</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="exp-tab" data-bs-toggle="tab" data-bs-target="#expense-summary" type="button" role="tab">Expenses</button>
                    </li>
                </ul>
                <div class="tab-content border border-top-0 p-3" id="summaryTabContent">
                    <div class="tab-pane fade show active" id="sum" role="tabpanel">
                        <div id="summaryContent"></div>
                    </div>
                    <div class="tab-pane fade" id="income-summary" role="tabpanel">
                        <div id="incomeSummaryContent"></div>
                    </div>
                    <div class="tab-pane fade" id="expense-summary" role="tabpanel">
                        <div id="expenseSummaryContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- end col-lg-4 -->
</div> <!-- end row -->

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/budget.js') }}"></script>
{% endblock %}
